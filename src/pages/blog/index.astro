---
import FeaturedPosts from "@/components/Pages/Posts/FeaturedPosts.astro";
import RegularPosts from "@/components/Pages/Posts/RegularPosts.astro";
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@/components/ui/breadcrumb";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Container from "@/layouts/Container.astro";
import { wpFetch } from "@/lib/wp";

const posts: any[] = await wpFetch(
  `/wp/v2/posts?per_page=100&orderby=date&order=desc&_fields=id,slug,date,link,title,excerpt,acf`
);

const slugOf = (p: any) => p.slug ?? p.link?.split("/").filter(Boolean).pop();
const imgOf = (p: any) =>
  p?.acf?.seo?.seo_image || "/images/news-placeholder.jpg";
const fmt = (iso: string) =>
  new Date(iso).toLocaleDateString("ru-RU", {
    day: "2-digit",
    month: "long",
    year: "numeric",
  });

const [featured, ...rest] = posts;
const highlights = rest.slice(0, 2);
const masonry = rest.slice(2);
const ymd = new Date().toISOString().split("T")[0];

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    headline: 'Новости Car1.by — Прокат автомобилей в Бресте',
    datePublished: ymd,
    dateModified: ymd,
    inLanguage: "ru",
    description: 'Cервис проката автомобилей Car1.by в Бресте — свежие новости и статьи',
    mainEntityOfPage: { "@type": "WebPage", "@id": "https://car1.by" },
    email: "car1prokat@gmail.com",
    contactPoint: {
      "@type": "ContactPoint",
      telephone: "+375 25 780-88-08",
      contactType: "customer service",
      areaServed: "BY",
      availableLanguage: ["Russian", "English"],
    },
    address: {
      "@type": "PostalAddress",
      addressLocality: "Брест",
      addressCountry: "BY",
      streetAddress: "ул. Шоссейная, 16, офис 202",
    },
    sameAs: [
      "https://api.whatsapp.com/send/?phone=375257808808",
      "https://t.me/Car4_brest",
      "https://www.instagram.com/car4.by/",
    ],
  },
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    name: 'Новости Car1.by — Прокат автомобилей в Бресте',
    url: "https://car1.by/",
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
      {
        "@type": "ListItem",
        position: 1,
        name: "Главная",
        item: "https://car1.by/",
      },
      {
        "@type": "ListItem",
        position: 2,
        name: "Новости",
        item: "https://car1.by/blog/",
      },
    ],
  },
];
---

<BaseLayout className="scrolled"
  title="Новости"
  description="Cервис проката автомобилей в Бресте — свежие новости и статьи"
>
  <Container class="my-24">
    <Breadcrumb>
      <BreadcrumbList>
        <BreadcrumbItem>
          <BreadcrumbLink href="/">Главная</BreadcrumbLink>
        </BreadcrumbItem>
        <BreadcrumbSeparator />
        <BreadcrumbItem>
          <BreadcrumbPage>Новости</BreadcrumbPage>
        </BreadcrumbItem>
      </BreadcrumbList>
    </Breadcrumb>
    <div>
          {
      featured && (
        <FeaturedPosts {slugOf} {imgOf} {fmt} {featured} {highlights} />
      )
    }

    <!-- Masonry-лента -->
    <RegularPosts {slugOf} {imgOf} {fmt} {masonry} />
    </div>
  </Container>
</BaseLayout>
